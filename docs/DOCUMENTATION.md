# Documentation Generation Guide

This project uses **TypeDoc** to generate comprehensive API documentation from TypeScript source code, combined with hand-written guides covering XPath 2.0 implementation, migration, and incompatibilities.

## Documentation Structure

```
docs/
├── README.md                    # Main documentation entry point
├── api/                         # Auto-generated TypeDoc API reference
│   ├── modules.md               # Main modules index
│   ├── classes/                 # Class documentation
│   ├── interfaces/              # Interface documentation
│   ├── functions/               # Function documentation
│   ├── enumerations/            # Enum documentation
│   ├── type-aliases/            # Type alias documentation
│   └── variables/               # Variable documentation
└── guides/                      # Hand-written guides
    ├── XPATH-2.0-IMPLEMENTATION-PLAN.md  # Full feature roadmap
    ├── XPATH-MIGRATION-GUIDE.md           # XPath 1.0 to 2.0 migration
    └── XPATH-INCOMPATIBILITIES.md         # Version incompatibilities reference
```

## Generating Documentation

### Build API Documentation

```bash
npm run docs
```

This generates TypeDoc markdown documentation in `docs/api/`.

### Watch Mode (During Development)

```bash
npm run docs:watch
```

Regenerates documentation automatically when source code changes.

## Documentation Contents

### Main README (`docs/README.md`)

- Quick start guide with usage examples
- Overview of all 10 implementation phases
- Feature highlights
- Test coverage summary
- Links to detailed guides

### API Reference (`docs/api/`)

Auto-generated from TypeScript source code using TypeDoc:

- **Classes**: `XPathBaseParser`, `XPathLexer`, `XPathContext`, etc.
- **Interfaces**: `XPathEvaluationResult`, `XPathParserOptions`, `XPathNode`, etc.
- **Functions**: `evaluate()`, `createWarningCollector()`, type constructors, etc.
- **Types**: All atomic types, expression types, error types
- **Enumerations**: `NodeType`, token types, etc.

### Guides

#### Implementation Plan (`guides/XPATH-2.0-IMPLEMENTATION-PLAN.md`)

Comprehensive summary of the XPath 2.0 implementation:

- All 10 implementation phases with completion status
- Feature matrix across all phases
- Test coverage details (1176 tests, 77% coverage)
- Architecture highlights
- W3C specification alignment
- Next steps for post-MVP work

**Use this to:**
- Understand what features are available
- See test coverage metrics
- Find links to relevant W3C specifications
- Plan post-MVP enhancements

#### Migration Guide (`guides/XPATH-MIGRATION-GUIDE.md`)

Step-by-step guide for migrating from XPath 1.0 to 2.0:

- Quick start with compatibility mode
- Key conceptual differences
- Step-by-step migration process
- Common migration patterns
- Handling empty sequences
- Type safety improvements
- New XPath 2.0 features
- Testing strategies
- Troubleshooting

**Use this to:**
- Understand XPath 1.0 to 2.0 differences
- Migrate existing 1.0 expressions
- Learn new XPath 2.0 features
- Fix compatibility issues

#### Incompatibilities Reference (`guides/XPATH-INCOMPATIBILITIES.md`)

Detailed reference of all XPath 1.0 to 2.0 incompatibilities:

- Type system differences
- String comparison changes
- Empty sequence handling (most significant)
- Arithmetic expression changes
- Comparison operator changes
- Boolean expression behavior
- Deprecated features (namespace axis)
- New reserved words
- Function signature changes

**Use this to:**
- Deep dive into specific incompatibilities
- Understand technical details of differences
- Consult detailed change tables
- Reference error codes and examples

## Configuration

TypeDoc is configured in `typedoc.json`:

```json
{
  "entryPoints": ["src/index.ts"],
  "outputs": [{"name": "markdown", "path": "docs/api"}],
  "plugin": ["typedoc-plugin-markdown"],
  "excludeExternals": true,
  "excludePrivate": true,
  "hideGenerator": true
}
```

Key settings:
- **entryPoints**: Entry point for API documentation (src/index.ts exports everything)
- **outputs**: Generate markdown documentation in docs/api
- **plugin**: Use typedoc-plugin-markdown for markdown output
- **excludeExternals**: Don't include external dependencies
- **excludePrivate**: Hide private APIs
- **hideGenerator**: Don't show "Generated by TypeDoc" footer

## Publishing Documentation

### GitHub Pages

To publish documentation to GitHub Pages:

1. Generate docs: `npm run docs`
2. Commit docs/ folder to git
3. Enable GitHub Pages in repo settings (source: main branch /docs folder)

### NPM Package

Include docs in npm package:

```json
{
  "files": [
    "dist/",
    "docs/"
  ]
}
```

### Local Viewing

Open `docs/README.md` in any markdown viewer, or:

1. Generate HTML from markdown (using tools like `markdown-to-html`)
2. Serve with local HTTP server
3. Open in browser

## Keeping Documentation Up-to-Date

### API Reference

Automatically regenerated via `npm run docs`. To keep in sync:

1. Update TypeScript source code
2. Add/update JSDoc comments for public APIs
3. Run `npm run docs`
4. Commit changes

### Guides

Hand-written guides in `docs/guides/` should be updated when:

- Implementation plan changes (new phases, completion status)
- Migration patterns change
- New incompatibilities discovered
- Feature set changes

### Workflow

```
Code changes
    ↓
Update JSDoc comments
    ↓
npm run docs (regenerates API docs)
    ↓
Update guides/ if needed
    ↓
Commit both source and generated docs
    ↓
Push to GitHub
```

## Troubleshooting

### Documentation Build Errors

If TypeDoc fails to generate:

1. Check `typedoc.json` for syntax errors
2. Verify `src/index.ts` exists and exports public API
3. Clear cache: `rm -rf docs/api`
4. Run `npm run docs` again

### Missing or Incomplete API Docs

Ensure public APIs have JSDoc comments:

```typescript
/**
 * Evaluates an XPath expression against a node.
 * 
 * @param expression - XPath expression string
 * @param node - XML node to evaluate against
 * @param options - Optional evaluation options
 * @returns Evaluation result
 * 
 * @example
 * ```typescript
 * const result = evaluate('/root/child', document);
 * ```
 */
export function evaluate(expression: string, node: any, options?: EvaluationOptions) {
    // implementation
}
```

### Links Not Working

Check:
- Relative paths use `./` prefix for same directory
- Files have `.md` extension
- Directory structure matches actual files
- No circular references

## Best Practices

1. **Keep JSDoc comments updated** - They're the source for API docs
2. **Use examples** - `@example` blocks help users
3. **Link to guides** - Reference migration guide, incompatibilities in relevant places
4. **Update frequently** - Run `npm run docs` after significant changes
5. **Review generated docs** - Check that output looks correct before committing
6. **Test links** - Verify all cross-references work

---

**Last Updated**: January 25, 2026
